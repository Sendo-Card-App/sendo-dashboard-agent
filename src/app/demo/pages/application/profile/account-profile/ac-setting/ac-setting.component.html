 <!-- Section Pincode -->
  <div class="setting-section">
    <div class="section-header">
      <div class="section-info">
        <h3 class="section-title">
          <i class="ti ti-lock me-2"></i>
          Gestion du Code PIN
        </h3>
        <p class="section-description">
          Configurez et gérez votre code PIN pour sécuriser vos transactions
        </p>
      </div>
      <div class="section-status">
        <span class="status-badge" [class]="hasPincode ? 'status-active' : 'status-inactive'">
          {{ hasPincode ? 'Configuré' : 'Non configuré' }}
        </span>
      </div>
    </div>

    <div class="section-actions">
      <!-- Vérifier le pincode -->
      <button 
      mat-flat-button color="primary"
        class="btn btn-outline-primary" 
        (click)="toggleVerifyPincodeSection()"
        [disabled]="!hasPincode">
        <i class="ti ti-key me-2"></i>
        Vérifier le PIN
      </button>

      <!-- Envoyer passcode -->
      <button 
      mat-flat-button color="primary"
        class="btn btn-outline-secondary" 
        (click)="togglePasscodeSection()">
        <i class="ti ti-send me-2"></i>
        Générer un passcode
      </button>
    </div>

    <!-- Section vérification pincode -->
    <div *ngIf="showVerifyPincodeSection" class="form-section">
      <div class="form-header">
        <h4>Vérifier votre code PIN</h4>
        <p>Saisissez votre code PIN actuel pour vérification</p>
      </div>

      <div class="pincode-input-container">
        <div class="pincode-input-group">
          <input
            #verifyPinInput1
            type="password"
            maxlength="1"
            class="pincode-digit"
            (input)="onVerifyPincodeInput(0, $event, verifyPinInput2)"
            (keydown)="onVerifyPincodeKeyDown(0, $event)"
            pattern="[0-9]"
          >
          <input
            #verifyPinInput2
            type="password"
            maxlength="1"
            class="pincode-digit"
            (input)="onVerifyPincodeInput(1, $event, verifyPinInput3)"
            (keydown)="onVerifyPincodeKeyDown(1, $event)"
            pattern="[0-9]"
          >
          <input
            #verifyPinInput3
            type="password"
            maxlength="1"
            class="pincode-digit"
            (input)="onVerifyPincodeInput(2, $event, verifyPinInput4)"
            (keydown)="onVerifyPincodeKeyDown(2, $event)"
            pattern="[0-9]"
          >
          <input
            #verifyPinInput4
            type="password"
            maxlength="1"
            class="pincode-digit"
            (input)="onVerifyPincodeInput(3, $event, null)"
            (keydown)="onVerifyPincodeKeyDown(3, $event)"
            pattern="[0-9]"
          >
        </div>

        <div *ngIf="verifyPincodeError" class="error-message">
          <i class="ti ti-alert-circle me-2"></i>
          {{ verifyPincodeError }}
        </div>
      </div>

      <div class="form-actions">
        <button
          class="btn btn-outline-secondary"
          (click)="cancelVerifyPincode()"
          [disabled]="isVerifyingPincode">
          Annuler
        </button>
        <button
          class="btn btn-primary"
          (click)="verifyPincode()"
          [disabled]="!isVerifyPincodeComplete || isVerifyingPincode">
          <span *ngIf="!isVerifyingPincode">Vérifier le PIN</span>
          <span *ngIf="isVerifyingPincode">
            <i class="ti ti-loader spinner me-2"></i>
            Vérification...
          </span>
        </button>
      </div>
    </div>

    <!-- Section envoi passcode (MAINTENANT 4 CHIFFRES) -->
    <div *ngIf="showPasscodeSection" class="form-section">
      <div class="form-header">
        <h4>Envoyer un Passcode</h4>
        <p>Générez et envoyez un passcode à 4 chiffres</p> <!-- Changé le texte -->
      </div>

      <div class="passcode-input-container">
        <div class="passcode-input-group">
          <!-- 4 inputs au lieu de 6 -->
          <input
            #passcodeInput1
            type="password"
            maxlength="1"
            class="passcode-digit"
            (input)="onPasscodeInput(0, $event, passcodeInput2)"
            (keydown)="onPasscodeKeyDown(0, $event)"
            pattern="[0-9]"
          >
          <input
            #passcodeInput2
            type="password"
            maxlength="1"
            class="passcode-digit"
            (input)="onPasscodeInput(1, $event, passcodeInput3)"
            (keydown)="onPasscodeKeyDown(1, $event)"
            pattern="[0-9]"
          >
          <input
            #passcodeInput3
            type="password"
            maxlength="1"
            class="passcode-digit"
            (input)="onPasscodeInput(2, $event, passcodeInput4)"
            (keydown)="onPasscodeKeyDown(2, $event)"
            pattern="[0-9]"
          >
          <input
            #passcodeInput4
            type="password"
            maxlength="1"
            class="passcode-digit"
            (input)="onPasscodeInput(3, $event, null)"
            (keydown)="onPasscodeKeyDown(3, $event)"
            pattern="[0-9]"
          >
        </div>

        <div *ngIf="passcodeError" class="error-message">
          <i class="ti ti-alert-circle me-2"></i>
          {{ passcodeError }}
        </div>
      </div>

      <div class="form-actions">
        <button
          class="btn btn-outline-secondary"
          mat-flat-button color="primary"
          (click)="cancelPasscode()"
          [disabled]="isLoading">
          Annuler
        </button>
        <button
          class="btn btn-primary"
          mat-flat-button color="primary"
          (click)="sendPasscode()"
          [disabled]="!isPasscodeComplete || isLoading">
          <span *ngIf="!isLoading">Generer un passcode</span>
          <span *ngIf="isLoading">
            <i class="ti ti-loader spinner me-2"></i>
            Envoi...
          </span>
        </button>
      </div>
    </div>
  </div>

  <!-- Informations de sécurité -->
  <div class="security-info">
    <h4>
      <i class="ti ti-shield-check me-2"></i>
      Informations de sécurité
    </h4>
    <div class="info-list">
      <div class="info-item">
        <i class="ti ti-lock text-primary"></i>
        <div class="info-content">
          <strong>Code PIN</strong>
          <p>Code à 4 chiffres pour authentifier vos transactions</p>
        </div>
      </div>
      <div class="info-item">
        <i class="ti ti-key text-success"></i>
        <div class="info-content">
          <strong>Passcode</strong>
          <p>Code à 4 chiffres pour des opérations spécifiques</p> <!-- Changé le texte -->
        </div>
      </div>
      <div class="info-item">
        <i class="ti ti-shield text-warning"></i>
        <div class="info-content">
          <strong>Sécurité</strong>
          <p>Ne partagez jamais vos codes avec qui que ce soit</p>
        </div>
      </div>
    </div>
  </div>